version: 0.6.0.{build}
image:
  - Visual Studio 2019
  - Ubuntu

environment:
  CLICKHOUSE_CONNECTION: Host=localhost;Port=8123

nuget:
  project_feed: false
  disable_publish_on_pr: true

services:
- docker

dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'

before_build:
- dotnet restore

build:
  parallel: true
  project: ClickHouse.Client.sln
  publish_aspnet_core: true
  publish_nuget: true
  publish_nuget_symbols: true
  include_nuget_references: true 
  use_snupkg_format: true
  verbosity: minimal

before_test:
- docker pull yandex/clickhouse-server
- docker run -p 8123:8123 -d --name clickhouse-server yandex/clickhouse-server
- sleep 3

for:
- matrix:
    only:
      - image: Ubuntu
  build:
    project: ClickHouse.Client.sln
    publish_aspnet_core: false
    publish_nuget: false
    publish_nuget_symbols: false
- matrix:
    only:
      - image: Visual Studio 2019
